parameters:
- name: branchName
  type: string
  default: dev

trigger: none

variables:
  - group: ${{ parameters.branchName }}

jobs:  
  - job: docker_build_push
    pool:
      vmImage: 'ubuntu-latest'
        
    steps:
      - task: DownloadSecureFile@1
        name: overrideFile
        inputs:
          secureFile: $(secureFileName)

      - task: HelmDeploy@0
        displayName: Helm upgrade
        inputs:
          connectionType: 'Kubernetes Service Connection'
          kubernetesServiceConnection: $(kubeCon)
          namespace: $(namespace)
          command: upgrade
          chartType: filepath
          chartPath: ./chart
          releaseName: base-setup
          valueFile: $(overrideFile.secureFilePath)
          install: true
          waitForExecution: true
